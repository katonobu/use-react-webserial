(this["webpackJsonpuse-react-webserial-example"]=this["webpackJsonpuse-react-webserial-example"]||[]).push([[0],{10:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);n(10);var r=n(0),a=n.n(r),o=n(6),c=n.n(o),s=n(1),l=n.n(s),i=n(2),u=Object(r.createContext)(),d=function(){var e,t;return function(){var n=function(){console.log("OnOpen()")},r=function(){console.log("OnClose()")},a=function(e){console.log("OnMessage(",e,")")},o=function(e){console.log(e)};console.log("webSerialIo() is called");var c=function(){e=void 0,r()};return{openPort:function(){var r=Object(i.a)(l.a.mark((function r(s,i){var u,d,p,b,f,v,g;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=s||[],r.prev=1,r.next=4,navigator.serial.requestPort({filters:u});case 4:return d=r.sent,p=i||{baudRate:115200,dataBits:8,stopBits:1,parity:"none",bufferSize:255,flowControl:"none"},r.prev=6,r.next=9,d.open(p);case 9:e=d,n();case 11:if(null===(b=e)||void 0===b||!b.readable){r.next=34;break}r.prev=12,t=e.readable.getReader();case 14:return r.next=16,t.read();case 16:if(f=r.sent,v=f.value,g=f.done,v&&a(v),!g){r.next=22;break}return r.abrupt("break",24);case 22:r.next=14;break;case 24:t.releaseLock(),t=void 0,r.next=32;break;case 28:return r.prev=28,r.t0=r.catch(12),o(r.t0),r.abrupt("break",34);case 32:r.next=11;break;case 34:if(!e){r.next=44;break}return r.prev=35,r.next=38,e.close();case 38:c(),r.next=44;break;case 41:r.prev=41,r.t1=r.catch(35),o(r.t1);case 44:r.next=49;break;case 46:r.prev=46,r.t2=r.catch(6),o(r.t2);case 49:r.next=54;break;case 51:r.prev=51,r.t3=r.catch(1),o(r.t3);case 54:case"end":return r.stop()}}),r,null,[[1,51],[6,46],[12,28],[35,41]])})));return function(e,t){return r.apply(this,arguments)}}(),closePort:function(){var n=Object(i.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e,e=void 0,!t){n.next=5;break}return n.next=5,t.cancel();case 5:if(!r){n.next=15;break}return n.prev=6,n.next=9,r.close();case 9:c(),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(6),o(n.t0);case 15:case"end":return n.stop()}}),n,null,[[6,12]])})));return function(){return n.apply(this,arguments)}}(),sendMessage:function(t){var n;if(null!==(n=e)&&void 0!==n&&n.writable)try{var r=e.writable.getWriter();r.write(t),r.releaseLock()}catch(a){o(a)}else o(new Error("Can't send message, serial pot may not open."))},updateCallbacks:function(e){var t=e.onOpen,c=e.onClose,s=e.onMessage,l=e.onError;t&&(n=t),c&&(r=c),s&&(a=s),l&&(o=l)}}}}()(),p=d.openPort,b=d.closePort,f=d.sendMessage,v=d.updateCallbacks,g=function(e){var t=e.children,n=(e.options,e.parserMethod);return a.a.createElement(u.Provider,{value:{openPort:p,closePort:b,sendMessage:f,parserMethod:n,updateCallbacks:v}},t)},E=n(3),k=function(e){var t=e.serialAvailable,n=e.isConnected,r=e.openPort,o=e.closePort,c=e.onError,s=e.requestPortFilters,u=e.openOptions;return a.a.createElement("button",{disabled:!t,onClick:Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=11;break}return e.prev=1,e.next=4,o();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),c(e.t0);case 9:e.next=12;break;case 11:try{r(s,u)}catch(t){c(t)}case 12:case"end":return e.stop()}}),e,null,[[1,6]])})))},n?"CLOSE":"OPEN")},x=function(e){var t=e.disabled,n=e.sendMessage,r=e.cmdStr,o=e.dispStr;return a.a.createElement("button",{disabled:t,onClick:function(){n((new TextEncoder).encode(r+"\r\n"))}},o)},m=function(e){var t=e.serialAvailable,n=e.isConnected,r=e.openPort,o=e.closePort,c=e.onError,s=e.sendMessage;return a.a.createElement(a.a.Fragment,null,a.a.createElement(k,{serialAvailable:t,isConnected:n,openPort:r,closePort:o,onError:c}),a.a.createElement(x,{disabled:!t||!n,sendMessage:s,cmdStr:"< TEST RSP 1000",dispStr:"1000sec"}),a.a.createElement(x,{disabled:!t||!n,sendMessage:s,cmdStr:"< TEST RSP 500",dispStr:"500sec"}),a.a.createElement(x,{disabled:!t||!n,sendMessage:s,cmdStr:"< TEST RSP 100",dispStr:"100sec"}))},P=n(8),O=Object(P.a)((function(){return Promise.all([n.e(4),n.e(3)]).then(n.bind(null,19))})),S=function(){var e=function(){var e=Object(r.useContext)(u);return{openPort:e.openPort,closePort:e.closePort,sendMessage:e.sendMessage,parserMethod:e.parserMethod,updateCallbacks:e.updateCallbacks}}(),t=e.openPort,n=e.closePort,o=e.sendMessage,c=e.updateCallbacks,s=Object(r.useCallback)((function(e){console.log(e)}),[]),l=Object(r.useState)(!0),i=Object(E.a)(l,2),d=i[0],p=i[1],b=Object(r.useState)(!1),f=Object(E.a)(b,2),v=f[0],g=f[1];Object(r.useEffect)((function(){c({onOpen:function(){console.log("onOpen()"),g(!0);var e=new TextEncoder;o(e.encode("< TEST EVT 0,100,10\r\n"))},onClose:function(){console.log("onClose()"),g(!1)},onMessage:function(e){var t=(new TextDecoder).decode(e);console.log(t),S((new Date).toLocaleString()+":"+t)},onError:s}),p("serial"in navigator)}),[c,s,o]);var k=Object(r.useState)(""),x=Object(E.a)(k,2),P=x[0],S=x[1];return Object(r.useEffect)((function(){return S("Start at "+(new Date).toLocaleString()),function(){S("End at "+(new Date).toLocaleString())}}),[]),a.a.createElement(a.a.Fragment,null,a.a.createElement(m,{serialAvailable:d,isConnected:v,openPort:t,closePort:n,onError:s,sendMessage:o}),a.a.createElement(O,{message:P}))},h=function(){return a.a.createElement(g,null,a.a.createElement(S,null))};c.a.render(a.a.createElement(h,null),document.getElementById("root"))},9:function(e,t,n){e.exports=n(17)}},[[9,1,2]]]);
//# sourceMappingURL=main.33afb481.chunk.js.map